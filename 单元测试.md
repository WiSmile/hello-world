## 什么是单元测试
百度百科中的定义<br>
- 单元：人为规定的最小的被测功能模块，如C语言中单元指一个函数，Java里单元指一个类，图形化的软件中可以指一个窗口或一个菜单等<br>
- 单元测试：对软件中最小可测单元进行检查和验证

单元测试，每个人对于单元的定义不一致，导致单元测试的定义范围大小都有，而在实际应用中，更容易因为一些原因让单元测试的范围变的模糊不定。有人把单元测试深究定义归结为最单一的方法，不使用其他类、其他方法、数据库等。有人把单元测试放大到跟功能测试甚至集成测试混为一谈。==我理解为，测试一个只做一件事的函数，即为单元测试==

## 抗拒单元测试的理由
在有意向引入单元测试的前提下，在了解和接触单元测试的过程中，总结了各式各样的抗拒单元测试的理由
- 代码原来就没有单元测试，突然引入的话让开发人员多了一项工作，延长了开发时间
- 需求总是无穷无尽的，还有下阶段功能需求要实现，没空补单元测试
- 要补的单元测试太多，无从下手，主观上抗拒
- 现有代码的单元测试编写难度大
- 需求更新换代迅速，没过多久需求都砍了，为什么要费心费力写单元测试
- 没有单元测试照样做了开发过了这么久，况且有这么多理由拒绝，为什么要写单元测试，给自己找事儿嘛？

理由很真实，符合人们着重眼前、天性慵懒的特性，也符合大多数开发者任务繁重、疯狂赶进度的现状。

## 尽管如此还是要写单元测试的理由
既然要写单元测试，肯定是抵着反驳的言论逆流而上的，上面列举了多条拒绝单元测试的理由，现在解释一下为什么尽管如此还是要写单元测试<br>
抗拒的理由大部分都是着重眼前和现在，而推行的理由更多的是着眼未来
- 写单元测试不一定会延长开发时间，因为它可以减少开发中的测试时间、减少bug、减少发现bug的成本。并且在未来，有助于其他人理解你的代码，进行重构和学习。好的单元测试可以替代注释和需求文档
- 单独弥补单元测试也许并不能写出好的单元测试，因为测试不是向代码靠拢。拿“代码没问题，让单元测试跑通”的思维去写单元测试，是为了证明代码的正确性，这种观念在1957-1978年很流行。补单元测试，应该建立在重构跟学习的基础上，而重构是保持代码鲜活性、稳定性的必要过程，顺便补个单元测试有助于重构
- 无从下手，可以从简单地、可测的代码进行单元测试编写，复杂繁琐的单元测试边学习边重构边写
- 单元测试可以验证接口设计是否合理，逻辑是否正确，分层是否合适。编写难度大有两个原因：1、这个函数是个功能集合函数，本不需要单元测试，需要的是功能测试；2、代码写的逻辑混乱、干了不止一件事，需要重构
- 单元测试不应该在开发完成后编写，它是辅助开发的利器。就像是保险，没用不是坏处
- 当有一个潜在小bug突然爆发、当你发现改了一行代码要测试十种场景、当一个五分钟的需求需要测试一个多小时，不写单元测试，你是在给未来的自己找事儿嘛，还是给下一个接班侠找事儿？

## 单元测试的意义
首先我们达成共识：好代码很重要
> 糟糕的代码代价很大，足以毁掉一个公司。
<br> 稍后等于永不——现在时间太紧，先完成功能，有朝一日再回头清理，但事实是从来没有回头优化过代码
<br> 混乱的代码使团队的生产力持续下降，趋向于零

<p align="right">——《代码整洁之道》</p>

#### 单元测试与代码耦合度
如果想单元测试简单实用，需要做到以下几点
- 对需求理解透彻，拆分成最小单元，也就是一个函数
- 代码耦合度低，每个函数只做一件事
- 清除界定函数的功能，把函数像螺丝一样放到该放的地方

平时我们写代码虽然也向着这些目标努力，但是缺乏衡量，到底怎么样才算好。<br>
单元测试帮你解决这个问题，编写单元测试迫使我们把程序设计成易于调用和可测试的，迫使我们接触软件中的耦合。

#### 单元测试与重构
重构：就是在不改变软件系统外部行为的前提下,改善它的内部结构。<br>
改变一个底层函数的内部实现之后，我们怎么保证它的功能跟以前一样？把所有调用点测试一遍是否过于浪费时间。<br>
单元测试帮你解决这个问题，只要保证原来的功能跟现在的功能是一样的，跑通单元测试就可以保证正确性。当然这有两个前提，1、函数所做的事跟以前一样，不一样的话请另写；2、单元测试写得好，要是单元测试本身有问题，啥都白扯

#### 单元测试充当文档
当开发人员去修改、学习别人的代码时，都会花费很大的力气去猜想作者的原始意图。所以写注释被列为开发人员好习惯之一，这会造成几个问题：
- 开发人员一般语文不好，至少我是如此。造成简单需求不需要注释，复杂需求注释解释不清意图的现象
- 注释具有时效性，开发人员在修改代码时常常忘记更新注释，因为这不影响程序运行和功能实现，这会造成系统中留下垃圾注释，反而对看注释的人造成更大的干扰
- 原始需求文档在开发完成后就会被丢在一边，有改进就会提新的需求文档，同注释一样，也具有时效性。况且找原始的需求文档本身就很费劲

于是我们只能读代码，期待可以了解程序在做什么，还原需求<br>
单元测试帮你解决这些问题，因为改了代码就强迫开发人员改单元测试，不然跑不通。可以说单元测试是一种实时更新、可运行的文档，与代码对照，很容易了解意图

#### 单元测试让开发更自信
多一层测试，多一层保障，你值得拥有。<br>
频繁的功能测试、集成测试真是太浪费时间了，然而哪怕一个很小的需求我也会测好多遍，然而还是会出问题。这是我想要单元测试最初的目的。


## 对单元测试的思考
#### 其实开发充满单元测试的痕迹
例一：有时我们在review代码、给别人讲解代码时，常常会用到一种简单实用的方法：举例子。
> 讲解员：“比如这样一组数据。。。（此处省略一万字）。。。然后他输出了什么、改变了什么”<br>听众：“那如果我输入这样一组数据。。。（此处省略一万字）。。。然后你这段代码就崩了”

这不就是最简单的口头单元测试么？当对一个函数讲解的时候，举了大量的例子，不就是靠嘴代替单元测试代码来进行测试么。x种极端数据 * 讲给y个程序员 = 一件事重复了xy次，作为一个“天性懒惰”的程序员，不把这xy次重复写成代码交给程序未免显的太不专业了。况且随时间推移，作者能不能记得自己写的是啥也是个问题。

例二：有时我们在编写代码之前，会先梳理逻辑。比如前后端分离时，先写一些假接口，方便前后端并行开发；比如先将要写的函数梳理一遍起一个好名字，方便理清需求快速开发。既然定了这些接口，相必也了解自己到底期望这些函数做什么，这时候再给这些接口来一套单元测试，不就成了TDD开发了吗

例三：我们常常将复用的代码抽成函数，以便做修改的时候不需要修改多处，也防止少修改一处代码而造成错误。其实这只做到了第一步，虽然只需要该一处，还是要测多处，单元测试帮你解决这个问题

例四：在我们调试代码的时候经常做一些echo、print_r等操作<br>
“只要你想到输入一些东西到print语句或调试表达式中，就用测试代替它。” --Martin Fowler

单元测试的思维方式其实一直围绕在开发者身边，它并不是凭空出现的新事物，只是将一些习惯、方法总结整理出来的结晶，它对开发者并不陌生

#### 单元测试覆盖率
单元测试要写多细
> 老板为我的代码付报酬，而不是测试，所以，我对此的价值观是——测试越少越好，少到你对你的代码质量达到了某种自信（我觉得这种的自信标准应该要高于业内的标准，当然，这种自信也可能是种自大）。如果我的编码生涯中不会犯这种典型的错误（如：在构造函数中设了个错误的值），那我就不会测试它。我倾向于去对那些有意义的错误做测试，所以，我对一些比较复杂的条件逻辑会异常地小心。当在一个团队中，我会非常小心的测试那些会让团队容易出错的代码。
<p align="right">——Kent Beck</p>

上面这段看似否定单元测试的答案，是TDD创始人Kent Beck说的<br>
从而我们不难得出一个结论，那就是一味的追求单元测试覆盖率100%是错误的，而0%当然也是错误的，推荐阅读：[软件开发过程中值不值得写单元测试？](https://voidint.github.io/post/2017/10/24/ut/)


相关博客：
<br>1. [软件开发实践：我的单元测试历程--这是一根不错的拐棍](https://www.cnblogs.com/Rong-/p/7648918.html)
<br>2. [百度百科：单元测试](https://baike.baidu.com/item/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95#5)
<br>3. [开发人员必备技能：单元测试](https://baijiahao.baidu.com/s?id=1576454422319504844&wfr=spider&for=pc)
<br>4. [你真的需要单元测试吗?](https://blog.csdn.net/baidu_26118459/article/details/79882828)
<br>5. [软件开发过程中值不值得写单元测试？](https://voidint.github.io/post/2017/10/24/ut/)
<br>6. [单元测试整理（一）——单元测试是什么，有什么好处](https://note.youdao.com/https://blog.csdn.net/potatostyles/article/details/79152107)
<br>7. [一文帮你理解什么是单元测试](https://www.cnblogs.com/harlanc/p/6838155.html#_label1)
<br>8. [程序员为什么不写单元测试？](https://blog.csdn.net/dupeng0811/article/details/4300724)
<br>9. [单元测试系列一-为什么要写单元测试，何时写，写多细](https://blog.csdn.net/flysqrlboy/article/details/79301241)
<br>10. [软件测试发展历史](https://www.cnblogs.com/sallyzhang/p/6714264.html)
<br>11. [相遇Kent Beck，对话语思录](https://cloud.tencent.com/developer/news/314341)
